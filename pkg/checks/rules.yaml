########################################
#   CIS AUTHENTICATION RULES
########################################

- id: "CIS-5.1.1"
  title: "Disable root login over SSH"
  category: "Auth"
  fact: "ssh.permit_root_login"
  expected: "no"
  severity: "High"
  remediation: "Set 'PermitRootLogin no' in /etc/ssh/sshd_config and reload sshd."
  tags: ["cis", "ssh"]
  files:
    - /etc/ssh/sshd_config

- id: "CIS-5.1.6"
  title: "X11Forwarding disabled"
  category: "Auth"
  fact: "ssh.x11_forwarding"
  expected: "no"
  severity: "Low"
  remediation: "Set 'X11Forwarding no' in /etc/ssh/sshd_config and reload sshd."
  tags: ["cis", "ssh"]
  files:
    - /etc/ssh/sshd_config

- id: "CIS-5.1.14"
  title: "SSH Banner configured"
  category: "Auth"
  fact: "ssh.banner"
  expected: "present"
  severity: "Low"
  remediation: "Set 'Banner /etc/issue.net' or another approved file, then reload sshd."
  tags: ["cis", "ssh"]
  files:
    - /etc/ssh/sshd_config
    - /etc/issue.net


########################################
#  FILESYSTEM PERMISSIONS
########################################

- id: "CIS-1.1.2.2-devshm"
  title: "/dev/shm mounted with nodev,nosuid,noexec"
  category: "FS_Perms"
  fact: "mount.devshm_options"
  expected_all: ["nodev","nosuid","noexec"]
  severity: "High"
  remediation: "Ensure /dev/shm has nodev,nosuid,noexec by editing /etc/fstab or systemd mount configs."
  tags: ["cis", "fs"]
  files:
    - /etc/fstab

- id: "CIS-1.1.2.2-tmp"
  title: "/tmp mounted with nodev,nosuid,noexec"
  category: "FS_Perms"
  fact: "mount.tmp_options"
  expected_all: ["nodev","nosuid","noexec"]
  severity: "High"
  remediation: "Ensure /tmp has nodev,nosuid,noexec via /etc/fstab or systemd tmp.mount."
  tags: ["cis", "fs"]
  files:
    - /etc/fstab
    - /usr/lib/systemd/system/tmp.mount

- id: "CIS-1.1.2.2-vartmp"
  title: "/var/tmp mounted with nodev,nosuid,noexec"
  category: "FS_Perms"
  fact: "mount.vartmp_options"
  expected_all: ["nodev","nosuid","noexec"]
  severity: "High"
  remediation: "Ensure /var/tmp has nodev,nosuid,noexec."
  tags: ["cis", "fs"]
  files:
    - /etc/fstab


########################################
#   FIREWALL & SERVICE CONFIGURATION
########################################

- id: "CIS-4.1.1"
  title: "firewalld installed"
  category: "Services"
  fact: "pkg.firewalld_installed"
  expected: "present"
  severity: "High"
  remediation: "Install firewalld using your package manager and enable the service."
  tags: ["cis", "services"]
  files:
    - /usr/lib/systemd/system/firewalld.service

- id: "CIS-4.1.2"
  title: "firewalld enabled and active"
  category: "Services"
  fact: "svc.firewalld_state"
  expected: "enabled_active"
  severity: "High"
  remediation: "Run: systemctl enable --now firewalld"
  tags: ["cis", "services"]
  files:
    - /etc/firewalld


########################################
#   CRYPTO POLICY
########################################

- id: "CIS-1.6.1"
  title: "Crypto policy not LEGACY"
  category: "Auth"
  fact: "crypto.policy"
  expected: "NOT_LEGACY"
  severity: "Medium"
  remediation: "Run: update-crypto-policies --set DEFAULT (or higher)"
  tags: ["cis", "crypto"]
  files:
    - /etc/crypto-policies


########################################
#   SUDO HARDENING
########################################

- id: "CIS-5.2.2"
  title: "sudo uses pty"
  category: "Privileges"
  fact: "sudo.use_pty"
  expected: "true"
  severity: "High"
  remediation: "Add 'Defaults use_pty' to /etc/sudoers."
  tags: ["cis","sudo"]
  files:
    - /etc/sudoers

- id: "CIS-5.2.3"
  title: "sudo has logfile"
  category: "Privileges"
  fact: "sudo.logfile"
  expected: "true"
  severity: "Medium"
  remediation: "Add 'Defaults logfile=\"/var/log/sudo.log\"' to /etc/sudoers."
  tags: ["cis","sudo"]
  files:
    - /etc/sudoers


########################################
#  PRIVILEGE ESCALATION SAFETY
########################################

- id: "CIS-5.4.1"
  title: "Only root has UID 0"
  category: "Privileges"
  fact: "acct.uid0_unique"
  expected: "true"
  severity: "Critical"
  remediation: "Remove UID 0 from non-root accounts."
  tags: ["cis","accounts"]
  files:
    - /etc/passwd


########################################
# RECON / PRIVESC RULES
########################################

- id: "RC-1.1"
  title: "Unexpected SUID/SGID files found"
  category: "Recon"
  fact: "recon.suid_sgid_unexpected"
  expected: "none"
  severity: "High"
  remediation: "Remove unnecessary SUID/SGID files."
  tags: ["recon","privilege","local"]
  files:
    - /usr/bin
    - /usr/lib

- id: "RC-1.2"
  title: "World-writable directories in PATH"
  category: "Privileges"
  fact: "recon.path_world_writable"
  expected: "none"
  severity: "High"
  remediation: "Remove world-writable permissions from directories in PATH."
  tags: ["recon","privilege"]
  files:
    - /etc/profile
    - /etc/environment

